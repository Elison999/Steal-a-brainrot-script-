-- Sistema Completo Rayfield com Funcionalidades Avançadas
-- Carregamento da biblioteca Rayfield
local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

-- Serviços
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")

-- Variáveis globais
local LocalPlayer = Players.LocalPlayer
local Character = LocalPlayer.Character or LocalPlayer.CharacterAdded:Wait()
local Humanoid = Character:WaitForChild("Humanoid")
local RootPart = Character:WaitForChild("HumanoidRootPart")

-- Estados dos sistemas
local FloatEnabled = false
local ChairSystemEnabled = false
local PositionSystemEnabled = false
local SavedPosition = nil

-- Conexões ativas
local FloatConnection = nil
local ChairConnection = nil
local TeleportConnection = nil

-- Objetos da interface
local FloatButton = nil
local ChairButton = nil
local SaveButton = nil
local TeleportButton = nil
local ChairBlock = nil
local ChairControlsFrame = nil

-- Variáveis para controle de movimento contínuo
local MovementConnections = {}
local ChairHeight = 0

-- Função para criar barra de carregamento
local function ShowLoadingBar()
    local ScreenGui = Instance.new("ScreenGui")
    local Frame = Instance.new("Frame")
    local LoadingBar = Instance.new("Frame")
    local Fill = Instance.new("Frame")
    local LoadingText = Instance.new("TextLabel")
    local Corner = Instance.new("UICorner")
    local BarCorner = Instance.new("UICorner")
    local FillCorner = Instance.new("UICorner")
    
    ScreenGui.Name = "LoadingScreen"
    ScreenGui.Parent = game.CoreGui
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    Frame.Parent = ScreenGui
    Frame.BackgroundColor3 = Color3.fromRGB(20, 20, 20)
    Frame.BackgroundTransparency = 0.1
    Frame.Position = UDim2.new(0, 0, 0, 0)
    Frame.Size = UDim2.new(1, 0, 1, 0)
    
    Corner.CornerRadius = UDim.new(0, 12)
    Corner.Parent = Frame
    
    LoadingBar.Name = "LoadingBar"
    LoadingBar.Parent = Frame
    LoadingBar.BackgroundColor3 = Color3.fromRGB(45, 45, 45)
    LoadingBar.Position = UDim2.new(0.5, -200, 0.5, -15)
    LoadingBar.Size = UDim2.new(0, 400, 0, 30)
    
    BarCorner.CornerRadius = UDim.new(0, 8)
    BarCorner.Parent = LoadingBar
    
    Fill.Name = "Fill"
    Fill.Parent = LoadingBar
    Fill.BackgroundColor3 = Color3.fromRGB(100, 200, 255)
    Fill.Size = UDim2.new(0, 0, 1, 0)
    
    FillCorner.CornerRadius = UDim.new(0, 8)
    FillCorner.Parent = Fill
    
    LoadingText.Parent = Frame
    LoadingText.BackgroundTransparency = 1
    LoadingText.Position = UDim2.new(0.5, -100, 0.5, -50)
    LoadingText.Size = UDim2.new(0, 200, 0, 30)
    LoadingText.Font = Enum.Font.GothamBold
    LoadingText.Text = "Carregando Sistema..."
    LoadingText.TextColor3 = Color3.fromRGB(255, 255, 255)
    LoadingText.TextScaled = true
    
    -- Animação da barra
    local tween = TweenService:Create(Fill, TweenInfo.new(2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {Size = UDim2.new(1, 0, 1, 0)})
    tween:Play()
    
    tween.Completed:Connect(function()
        LoadingText.Text = "Sistema Carregado!"
        wait(0.5)
        ScreenGui:Destroy()
    end)
    
    wait(2.5)
end

-- Função para criar botão flutuante arrastável
local function CreateDraggableButton(text, color, position, callback)
    local ScreenGui = Instance.new("ScreenGui")
    local Button = Instance.new("TextButton")
    local Corner = Instance.new("UICorner")
    
    ScreenGui.Name = text .. "Gui"
    ScreenGui.Parent = game.CoreGui
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    
    Button.Parent = ScreenGui
    Button.BackgroundColor3 = color
    Button.Position = position
    Button.Size = UDim2.new(0, 120, 0, 40)
    Button.Font = Enum.Font.GothamBold
    Button.Text = text
    Button.TextColor3 = Color3.fromRGB(255, 255, 255)
    Button.TextScaled = true
    Button.Active = true
    Button.Draggable = true
    
    Corner.CornerRadius = UDim.new(0, 8)
    Corner.Parent = Button
    
    -- Efeito de hover
    Button.MouseEnter:Connect(function()
        TweenService:Create(Button, TweenInfo.new(0.2), {Size = UDim2.new(0, 130, 0, 45)}):Play()
    end)
    
    Button.MouseLeave:Connect(function()
        TweenService:Create(Button, TweenInfo.new(0.2), {Size = UDim2.new(0, 120, 0, 40)}):Play()
    end)
    
    Button.MouseButton1Click:Connect(callback)
    
    return ScreenGui
end

-- Sistema de flutuação
local function ToggleFloat()
    if FloatEnabled then
        FloatEnabled = false
        if FloatConnection then
            FloatConnection:Disconnect()
            FloatConnection = nil
        end
        if RootPart:FindFirstChild("BodyVelocity") then
            RootPart.BodyVelocity:Destroy()
        end
        if FloatButton then
            FloatButton.TextButton.Text = "Ativar Float"
            FloatButton.TextButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
        end
    else
        FloatEnabled = true
        local BodyVelocity = Instance.new("BodyVelocity")
        BodyVelocity.MaxForce = Vector3.new(4000, 4000, 4000)
        BodyVelocity.Velocity = Vector3.new(0, 16.2, 0)
        BodyVelocity.Parent = RootPart
        
        if FloatButton then
            FloatButton.TextButton.Text = "Desativar Float"
            FloatButton.TextButton.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
        end
        
        FloatConnection = RunService.Heartbeat:Connect(function()
            if not FloatEnabled then return end
            
            local moveVector = Humanoid.MoveDirection
            if moveVector.Magnitude > 0 then
                BodyVelocity.Velocity = Vector3.new(moveVector.X * 16, 16.2, moveVector.Z * 16)
            else
                BodyVelocity.Velocity = Vector3.new(0, 16.2, 0)
            end
        end)
    end
end

-- Variáveis para controle de movimento contínuo
local MovementConnections = {}
local ChairHeight = 0

-- Sistema de cadeira móvel
local function CreateChairControls()
    local ScreenGui = Instance.new("ScreenGui")
    local Frame = Instance.new("Frame")
    local Corner = Instance.new("UICorner")
    
    ScreenGui.Name = "ChairControls"
    ScreenGui.Parent = game.CoreGui
    
    Frame.Parent = ScreenGui
    Frame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    Frame.BackgroundTransparency = 0.2
    Frame.Position = UDim2.new(0.5, -90, 0.8, -75)
    Frame.Size = UDim2.new(0, 180, 0, 150)
    Frame.Active = true
    Frame.Draggable = true
    
    Corner.CornerRadius = UDim.new(0, 12)
    Corner.Parent = Frame
    
    -- Título do controle
    local Title = Instance.new("TextLabel")
    Title.Parent = Frame
    Title.BackgroundTransparency = 1
    Title.Position = UDim2.new(0, 0, 0, 5)
    Title.Size = UDim2.new(1, 0, 0, 25)
    Title.Font = Enum.Font.GothamBold
    Title.Text = "Controles da Cadeira"
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.TextScaled = true
    
    local buttons = {
        {text = "↑", pos = UDim2.new(0.5, -20, 0, 35), dir = Vector3.new(0, 0, -1)},
        {text = "←", pos = UDim2.new(0, 10, 0.5, -15), dir = Vector3.new(-1, 0, 0)},
        {text = "→", pos = UDim2.new(1, -50, 0.5, -15), dir = Vector3.new(1, 0, 0)},
        {text = "↓", pos = UDim2.new(0.5, -20, 1, -75), dir = Vector3.new(0, 0, 1)}
    }
    
    -- Função para parar movimento
    local function StopMovement(buttonId)
        if MovementConnections[buttonId] then
            MovementConnections[buttonId]:Disconnect()
            MovementConnections[buttonId] = nil
        end
    end
    
    -- Função para iniciar movimento contínuo
    local function StartMovement(direction, buttonId)
        StopMovement(buttonId) -- Para qualquer movimento anterior
        
        MovementConnections[buttonId] = RunService.Heartbeat:Connect(function()
            if ChairBlock then
                local newPosition = ChairBlock.Position + (direction * 0.5) -- Movimento mais suave
                ChairBlock.Position = newPosition
                
                -- Atualizar posição do assento também
                local seat = ChairBlock:FindFirstChild("Seat")
                if seat then
                    seat.Position = newPosition + Vector3.new(0, 0.75 + ChairHeight, 0)
                end
                
                -- Manter jogador na cadeira
                if Humanoid.Sit then
                    RootPart.CFrame = CFrame.new(newPosition + Vector3.new(0, 2 + ChairHeight, 0))
                end
            end
        end)
    end
    
    for i, buttonData in pairs(buttons) do
        local Button = Instance.new("TextButton")
        local ButtonCorner = Instance.new("UICorner")
        
        Button.Parent = Frame
        Button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
        Button.Position = buttonData.pos
        Button.Size = UDim2.new(0, 40, 0, 30)
        Button.Font = Enum.Font.GothamBold
        Button.Text = buttonData.text
        Button.TextColor3 = Color3.fromRGB(255, 255, 255)
        Button.TextScaled = true
        
        ButtonCorner.CornerRadius = UDim.new(0, 6)
        ButtonCorner.Parent = Button
        
        -- Evento de pressionar (segurar)
        Button.MouseButton1Down:Connect(function()
            Button.BackgroundColor3 = Color3.fromRGB(100, 150, 100)
            StartMovement(buttonData.dir, i)
        end)
        
        -- Evento de soltar
        Button.MouseButton1Up:Connect(function()
            Button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
            StopMovement(i)
        end)
        
        -- Hover effects
        Button.MouseEnter:Connect(function()
            if not MovementConnections[i] then
                Button.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
            end
        end)
        
        Button.MouseLeave:Connect(function()
            if not MovementConnections[i] then
                Button.BackgroundColor3 = Color3.fromRGB(60, 60, 60)
            end
            StopMovement(i) -- Para o movimento se sair do botão
        end)
    end
    
    -- Botões de altura
    local UpButton = Instance.new("TextButton")
    local UpCorner = Instance.new("UICorner")
    local DownButton = Instance.new("TextButton")
    local DownCorner = Instance.new("UICorner")
    local HeightLabel = Instance.new("TextLabel")
    
    -- Botão para subir
    UpButton.Parent = Frame
    UpButton.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
    UpButton.Position = UDim2.new(0, 10, 1, -40)
    UpButton.Size = UDim2.new(0, 35, 0, 30)
    UpButton.Font = Enum.Font.GothamBold
    UpButton.Text = "▲"
    UpButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    UpButton.TextScaled = true
    
    UpCorner.CornerRadius = UDim.new(0, 6)
    UpCorner.Parent = UpButton
    
    -- Botão para descer
    DownButton.Parent = Frame
    DownButton.BackgroundColor3 = Color3.fromRGB(200, 100, 100)
    DownButton.Position = UDim2.new(1, -45, 1, -40)
    DownButton.Size = UDim2.new(0, 35, 0, 30)
    DownButton.Font = Enum.Font.GothamBold
    DownButton.Text = "▼"
    DownButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    DownButton.TextScaled = true
    
    DownCorner.CornerRadius = UDim.new(0, 6)
    DownCorner.Parent = DownButton
    
    -- Label de altura
    HeightLabel.Parent = Frame
    HeightLabel.BackgroundTransparency = 1
    HeightLabel.Position = UDim2.new(0, 50, 1, -40)
    HeightLabel.Size = UDim2.new(0, 80, 0, 30)
    HeightLabel.Font = Enum.Font.Gotham
    HeightLabel.Text = "Altura: 0"
    HeightLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    HeightLabel.TextScaled = true
    
    -- Função para atualizar altura
    local function UpdateHeight(increment)
        ChairHeight = ChairHeight + increment
        ChairHeight = math.max(-2, math.min(10, ChairHeight)) -- Limitar entre -2 e 10
        
        HeightLabel.Text = "Altura: " .. math.floor(ChairHeight * 10) / 10
        
        if ChairBlock then
            local seat = ChairBlock:FindFirstChild("Seat")
            if seat then
                seat.Position = ChairBlock.Position + Vector3.new(0, 0.75 + ChairHeight, 0)
            end
            
            -- Atualizar posição do jogador se estiver sentado
            if Humanoid.Sit then
                RootPart.CFrame = CFrame.new(ChairBlock.Position + Vector3.new(0, 2 + ChairHeight, 0))
            end
        end
    end
    
    -- Eventos dos botões de altura (também seguráveis)
    local heightUpConnection = nil
    local heightDownConnection = nil
    
    -- Subir altura
    UpButton.MouseButton1Down:Connect(function()
        UpButton.BackgroundColor3 = Color3.fromRGB(120, 220, 120)
        UpdateHeight(0.1)
        
        heightUpConnection = RunService.Heartbeat:Connect(function()
            UpdateHeight(0.05) -- Movimento contínuo mais lento
        end)
    end)
    
    UpButton.MouseButton1Up:Connect(function()
        UpButton.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
        if heightUpConnection then
            heightUpConnection:Disconnect()
            heightUpConnection = nil
        end
    end)
    
    UpButton.MouseLeave:Connect(function()
        UpButton.BackgroundColor3 = Color3.fromRGB(100, 200, 100)
        if heightUpConnection then
            heightUpConnection:Disconnect()
            heightUpConnection = nil
        end
    end)
    
    -- Descer altura
    DownButton.MouseButton1Down:Connect(function()
        DownButton.BackgroundColor3 = Color3.fromRGB(220, 120, 120)
        UpdateHeight(-0.1)
        
        heightDownConnection = RunService.Heartbeat:Connect(function()
            UpdateHeight(-0.05) -- Movimento contínuo mais lento
        end)
    end)
    
    DownButton.MouseButton1Up:Connect(function()
        DownButton.BackgroundColor3 = Color3.fromRGB(200, 100, 100)
        if heightDownConnection then
            heightDownConnection:Disconnect()
            heightDownConnection = nil
        end
    end)
    
    DownButton.MouseLeave:Connect(function()
        DownButton.BackgroundColor3 = Color3.fromRGB(200, 100, 100)
        if heightDownConnection then
            heightDownConnection:Disconnect()
            heightDownConnection = nil
        end
    end)
    
    return ScreenGui
end

local function ToggleChairSystem()
    if ChairSystemEnabled then
        ChairSystemEnabled = false
        
        -- Parar todas as conexões de movimento
        for i, connection in pairs(MovementConnections) do
            if connection then
                connection:Disconnect()
            end
        end
        MovementConnections = {}
        ChairHeight = 0
        
        -- Remover cadeira e controles
        if ChairBlock then
            ChairBlock:Destroy()
            ChairBlock = nil
        end
        if ChairControlsFrame then
            ChairControlsFrame:Destroy()
            ChairControlsFrame = nil
        end
        if ChairButton then
            ChairButton.TextButton.Text = "Ativar Cadeira"
            ChairButton.TextButton.BackgroundColor3 = Color3.fromRGB(70, 70, 70)
        end
    else
        ChairSystemEnabled = true
        ChairHeight = 0 -- Reset da altura
        
        -- Criar bloco da cadeira
        ChairBlock = Instance.new("Part")
        ChairBlock.Name = "ChairBlock"
        ChairBlock.Parent = workspace
        ChairBlock.Size = Vector3.new(4, 1, 4)
        ChairBlock.Material = Enum.Material.Neon
        ChairBlock.BrickColor = BrickColor.new("Bright blue")
        ChairBlock.Anchored = true
        ChairBlock.CanCollide = true
        ChairBlock.Position = RootPart.Position - Vector3.new(0, 3, 0)
        
        -- Sentar no bloco
        local Seat = Instance.new("Seat")
        Seat.Name = "Seat"
        Seat.Parent = ChairBlock
        Seat.Size = Vector3.new(4, 0.5, 4)
        Seat.Position = ChairBlock.Position + Vector3.new(0, 0.75, 0)
        Seat.Material = Enum.Material.Fabric
        Seat.BrickColor = BrickColor.new("Really red")
        Seat.Anchored = true
        
        -- Criar controles
        ChairControlsFrame = CreateChairControls()
        
        if ChairButton then
            ChairButton.TextButton.Text = "Desativar Cadeira"
            ChairButton.TextButton.BackgroundColor3 = Color3.fromRGB(200, 100, 100)
        end
        
        -- Sentar automaticamente
        wait(0.1)
        Humanoid.Sit = true
        RootPart.CFrame = CFrame.new(ChairBlock.Position + Vector3.new(0, 2, 0))
    end
end

-- Sistema de salvamento de posição
local function SavePosition()
    SavedPosition = RootPart.Position
    game.StarterGui:SetCore("SendNotification", {
        Title = "Posição Salva!";
        Text = "Posição atual foi salva com sucesso.";
        Duration = 3;
    })
end

local function TeleportToSavedPosition()
    if SavedPosition then
        local targetCFrame = CFrame.new(SavedPosition)
        
        -- Animação de teleporte suave
        local startPos = RootPart.Position
        local distance = (SavedPosition - startPos).Magnitude
        local duration = math.min(distance / 50, 3) -- Máximo 3 segundos
        
        local bodyPosition = Instance.new("BodyPosition")
        bodyPosition.MaxForce = Vector3.new(4000, 4000, 4000)
        bodyPosition.Position = SavedPosition
        bodyPosition.Parent = RootPart
        
        wait(duration)
        bodyPosition:Destroy()
        
        game.StarterGui:SetCore("SendNotification", {
            Title = "Teleporte Concluído!";
            Text = "Você foi teleportado para a posição salva.";
            Duration = 3;
        })
    else
        game.StarterGui:SetCore("SendNotification", {
            Title = "Erro!";
            Text = "Nenhuma posição foi salva ainda.";
            Duration = 3;
        })
    end
end

-- Mostrar barra de carregamento
ShowLoadingBar()

-- Criar interface Rayfield
local Window = Rayfield:CreateWindow({
    Name = "Sistema Avançado de Movimentação",
    LoadingTitle = "Carregando Sistema...",
    LoadingSubtitle = "Por favor aguarde",
    ConfigurationSaving = {
        Enabled = true,
        FolderName = "MovementSystem",
        FileName = "Config"
    },
    Discord = {
        Enabled = false,
        Invite = "",
        RememberJoins = false
    },
    KeySystem = false
})

-- Tab Principal
local MainTab = Window:CreateTab("Main", 4483362458)

-- Toggle Float
local FloatToggle = MainTab:CreateToggle({
    Name = "Sistema de Flutuação",
    CurrentValue = false,
    Flag = "FloatToggle",
    Callback = function(Value)
        if Value then
            FloatButton = CreateDraggableButton("Ativar Float", Color3.fromRGB(70, 70, 70), UDim2.new(0, 50, 0, 100), ToggleFloat)
        else
            if FloatEnabled then
                ToggleFloat() -- Desativar se estiver ativo
            end
            if FloatButton then
                FloatButton:Destroy()
                FloatButton = nil
            end
        end
    end
})

-- Toggle Chair System
local ChairToggle = MainTab:CreateToggle({
    Name = "Sistema de Cadeira Móvel",
    CurrentValue = false,
    Flag = "ChairToggle",
    Callback = function(Value)
        if Value then
            ChairButton = CreateDraggableButton("Ativar Cadeira", Color3.fromRGB(70, 70, 70), UDim2.new(0, 50, 0, 160), ToggleChairSystem)
        else
            if ChairSystemEnabled then
                ToggleChairSystem() -- Desativar se estiver ativo
            end
            if ChairButton then
                ChairButton:Destroy()
                ChairButton = nil
            end
        end
    end
})

-- Toggle Position System
local PositionToggle = MainTab:CreateToggle({
    Name = "Sistema de Salvamento de Posição",
    CurrentValue = false,
    Flag = "PositionToggle",
    Callback = function(Value)
        if Value then
            SaveButton = CreateDraggableButton("Salvar Pos", Color3.fromRGB(100, 150, 100), UDim2.new(0, 50, 0, 220), SavePosition)
            TeleportButton = CreateDraggableButton("Teleportar", Color3.fromRGB(150, 100, 150), UDim2.new(0, 180, 0, 220), TeleportToSavedPosition)
        else
            if SaveButton then
                SaveButton:Destroy()
                SaveButton = nil
            end
            if TeleportButton then
                TeleportButton:Destroy()
                TeleportButton = nil
            end
        end
    end
})

-- Seção de informações
MainTab:CreateSection("Informações do Sistema")

MainTab:CreateParagraph({
    Title = "Como usar:",
    Content = "1. Flutuação: Ative o toggle e use o botão que aparece\n2. Cadeira: Ative o toggle, segure os botões para mover, use ▲▼ para altura\n3. Posições: Salve e teleporte para posições específicas"
})

-- Notificação de inicialização
Rayfield:Notify({
    Title = "Sistema Carregado!",
    Content = "Todos os recursos foram carregados com sucesso.",
    Duration = 5,
    Image = 4483362458
})

-- Limpeza ao sair
game.Players.PlayerRemoving:Connect(function(player)
    if player == LocalPlayer then
        -- Limpar todas as conexões e objetos
        if FloatConnection then FloatConnection:Disconnect() end
        if ChairConnection then ChairConnection:Disconnect() end
        if TeleportConnection then TeleportConnection:Disconnect() end
    end
end)
